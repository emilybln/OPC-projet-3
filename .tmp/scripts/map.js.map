{"version":3,"sources":["map.js"],"names":["Map","constructor","lat","lon","myMap","L","map","currentPin","pinGreen","icon","iconUrl","iconSize","iconAnchor","popupAnchor","pinRed","domStationName","document","getElementById","domStationLocation","domStationStatus","domAvailableBikes","initMap","getStationData","setView","tileLayer","attribution","minZoom","maxZoom","addTo","fetchData","myHeaders","Headers","append","requestOptions","method","headers","redirect","response","fetch","jsonData","json","data","addMarker","station","available_bikes","status","marker","position","lng","displayData","displayDataStation","on","introEmpty","dataStationSelected","style","display","innerHTML","name","address"],"mappings":"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","sourcesContent":["class Map {\n    constructor(lat,lon) {\n        this.lat = lat;\n        this.lon = lon;\n        this.myMap = L.map('map');\n        this.currentPin = \"\";\n\n        this.pinGreen = L.icon({\n            iconUrl: '../images/pin_green.png',\n            iconSize: [40, 40],\n            iconAnchor: [20, 40],\n            popupAnchor: [-3, -76],\n        });\n        this.pinRed = L.icon({\n            iconUrl: '../images/pin_red.png',\n            iconSize: [40, 40],\n            iconAnchor: [20, 40],\n            popupAnchor: [-3, -76],\n        });\n\n\n        this.domStationName = document.getElementById('stationName');\n        this.domStationLocation = document.getElementById('stationLocation');\n        this.domStationStatus = document.getElementById('stationStatus');\n        this.domAvailableBikes = document.getElementById('availableBikes');\n\n        this.initMap();\n        this.getStationData();\n\n    }\n\n    // Méthode pour créer la map\n    initMap() {\n        this.myMap.setView([this.lat, this.lon], 12);\n        L.tileLayer('https://{s}.tile.openstreetmap.fr/osmfr/{z}/{x}/{y}.png', {\n            attribution: 'données © OpenStreetMap/ODbL - rendu OSM France',\n            minZoom: 1,\n            maxZoom: 20\n        }).addTo(this.myMap);\n\n        //this.markersCluster = new L.MarkerClusterGroup(); // Création des clusters\n        //this.myMap.addLayer(this.markersCluster)\n    }\n\n    async fetchData () {\n        let myHeaders = new Headers();\n        myHeaders.append(\"id\", \"16fb384f5213dfb5f267956480bdba613d304c76\");\n\n        let requestOptions = {\n            method: 'GET',\n            headers: myHeaders,\n            redirect: 'follow'\n        };\n\n        const response = await fetch('https://api.jcdecaux.com/vls/v1/stations?contract=marseille&apiKey=16fb384f5213dfb5f267956480bdba613d304c76', requestOptions);\n        const jsonData = await response.json();\n        return jsonData;\n    };\n\n    async getStationData () {\n        const data = await this.fetchData();\n        this.addMarker(data)\n    }\n\n    addMarker(data) {\n        for (let station of data) {\n            if (station.available_bikes === 0 && station.status === 'OPEN') {\n                var marker = L.marker([station.position.lat, station.position.lng], {icon: this.pinRed}).addTo(this.myMap);\n                //marker.bindPopup(station.name + \"Aucun vélo n'est disponible pour le moment\")\n            }\n            if (station.available_bikes > 0 && station.status === 'OPEN') {\n                var marker = L.marker([station.position.lat, station.position.lng], {icon: this.pinGreen}).addTo(this.myMap);\n                //marker.addEventListener('mouseover', marker.bindPopup(station.name +\"\\n\" + station.available_bikes+\"vélos disponibles\"));\n                //marker.bindPopup(station.name + station.available_bikes+\"vélos disponibles\");\n            }\n            if (station.status !== 'OPEN') {\n               var marker = L.marker([station.position.lat, station.position.lng], {icon: this.pinRed}).addTo(this.myMap);\n                //marker.bindPopup(\"La station\"+station.name+\"est actuellement fermée\")\n            }\n            const displayData = () => this.displayDataStation(station);\n            marker.on(\"click\", displayData);\n        }\n    }\n\n    displayDataStation(station) {\n        let introEmpty = document.getElementById(\"noStationSelected\");\n        let dataStationSelected = document.getElementById(\"dataStationSelected\");\n        introEmpty.style.display = \"none\";\n        dataStationSelected.style.display = \"block\";\n\n        if ( station.available_bikes > 0 && station.status === \"OPEN\") {\n            this.domStationStatus.innerHTML = \"Ouvert\";\n            this.domStationName.innerHTML = station.name;\n            this.domStationLocation.innerHTML = station.address;\n            this.domAvailableBikes.innerHTML = station.available_bikes;\n            document.getElementById(\"form\").style.display = \"block\"\n        }\n\n        else if (station.available_bikes === 0 && station.status === \"OPEN\"){\n            this.domStationStatus.innerHTML = \"Fermée\";\n            this.domStationName.innerHTML = station.name;\n            this.domStationLocation.innerHTML = station.address;\n            this.domAvailableBikes.innerHTML = \"Aucun vélo n'est disponible\";\n            document.getElementById(\"form\").style.display = \"none\"\n        }\n\n        else if (station.status !== \"OPEN\") {\n            this.domStationStatus.innerHTML = \"Fermée\";\n            this.domStationName.innerHTML = station.name;\n            this.domStationLocation.innerHTML = station.address;\n            this.domAvailableBikes.innerHTML = \"Aucun vélo n'est disponible\";\n            document.getElementById(\"form\").style.display = \"none\"\n\n        }\n    }\n\n\n}\n\n"],"file":"map.js"}